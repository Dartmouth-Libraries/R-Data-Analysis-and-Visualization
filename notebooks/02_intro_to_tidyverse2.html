<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jeremy Mikecz">

<title>tidyverse intro</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="02_intro_to_tidyverse2_files/libs/clipboard/clipboard.min.js"></script>
<script src="02_intro_to_tidyverse2_files/libs/quarto-html/quarto.js"></script>
<script src="02_intro_to_tidyverse2_files/libs/quarto-html/popper.min.js"></script>
<script src="02_intro_to_tidyverse2_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="02_intro_to_tidyverse2_files/libs/quarto-html/anchor.min.js"></script>
<link href="02_intro_to_tidyverse2_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="02_intro_to_tidyverse2_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="02_intro_to_tidyverse2_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="02_intro_to_tidyverse2_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="02_intro_to_tidyverse2_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">tidyverse intro</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Jeremy Mikecz </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="introduction-to-tidyverse" class="level1">
<h1>Introduction to Tidyverse</h1>
<p>Tidyverse is a system of R packages for data wrangling and analysis. It provides a different method and syntax for working with data tables (often called “data frames” in data science; but, tidyverse dataframes are known as “tibbles”) from base R.</p>
<p>For additional help learning how to use R’s tidyverse system of packages, see:</p>
<ul>
<li><p>Wickham, Çetinkaya-Rundel, and Grolemund, <a href="https://r4ds.hadley.nz/"><em>R for Data Science</em></a></p></li>
<li><p>Grolemund, <a href="https://rstudio-education.github.io/tidyverse-cookbook/">A Tidyverse Cookbook</a> (2020).!</p></li>
<li><p>package documentation: <a href="https://tidyverse.tidyverse.org/">tidyverse</a></p></li>
<li><p><a href="https://github.com/rstudio/cheatsheets/blob/main/tidyr.pdf">tidyr cheatsheet</a></p></li>
<li><p><a href="https://style.tidyverse.org/"><em>Tidyverse style guide</em></a></p></li>
</ul>
<p>For a more detailed introduction to working with tidy data in R see:</p>
<ul>
<li><p>Wickham, Çetinkaya-Rundel, and Grolemund, <em>R for Data Science</em>, Ch. 5 <a href="https://r4ds.hadley.nz/data-tidy">“Data Tidying”</a>.</p></li>
<li><p>Grolemund, <a href="https://rstudio-education.github.io/tidyverse-cookbook/">A Tidyverse Cookbook</a> (2020).</p></li>
<li><p>Silge and Robinson, <a href="https://www.tidytextmining.com/">Text Mining with R</a>, Ch. 1 “The tidy text format”.</p></li>
</ul>
<section id="optional-working-with-virtual-environments" class="level2">
<h2 class="anchored" data-anchor-id="optional-working-with-virtual-environments"><em>0. Optional</em>: Working with Virtual Environments</h2>
<p>If you are using R for a variety of different projects, you may risk encountering dependency conflicts. These occur when you may need Package <em>A</em> for a text analysis project and that package requires version 1.0 of Package <em>B</em>, while Package <em>C</em> for a machine-learning projects requires version 2.0 of Package <em>B</em>.</p>
<p>Setting up a virtual environment allows you to avoid such conflicts. Often, programmers use a different virtual environment for each project (and each project should be stored in a separate project folder). This also provides another benefit. When sharing code with others, programmers can send a list of packages (and their specific versions) to collaborators so that they can reproduce the exact same environment on their machines. This, in turn, ensures that the experience of running the team’s code is exactly the same for project members each working on their own computers.</p>
<p>In Python, users typically use the <strong>venv</strong> library to create and use virtual environments. In R, users often use the <strong>Packrat</strong> library / package.</p>
<p>To set up a local virtual environment with packrat:\</p>
<ol type="1">
<li>First, install packrat using <code>install.packages("packrat")</code>.</li>
<li>From within your project folder, initialize it using the command <code>packrat::init()</code>.</li>
<li>R should activite your new virtual environment automatically whenever you work in that project folder. To ensure it is activated, however, you can run the code <code>packrat::on()</code>. To deactivate, simply run <code>packrat::off()</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("packrat")</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">#packrat::init()</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">#packrat::on</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="getting-started-with-tidyverse" class="level2">
<h2 class="anchored" data-anchor-id="getting-started-with-tidyverse">1. Getting Started with Tidyverse</h2>
<p>Data analysis usually involves working with two-dimensional datasets known as dataframes. There are different ways to work with dataframes in R, these include:</p>
<ul>
<li><p>using core R dataframe functions</p></li>
<li><p>using the <strong>tibble</strong> a type of dataframe used with the tidyverse collection of packages</p></li>
<li><p>using other dataframe types like <strong>data.table</strong> for speed and to facilitate working with large datasets (i.e.&nbsp;with millions of rows)</p></li>
</ul>
<p>In these lessons, we will work with <a href="https://www.tidyverse.org/">tidyverse</a> a collection of packages designed for data science. Tidyverse works with <strong>tibbles</strong>, a customized and newer form of dataframes. For more on the differences between tibbles and dataframes see the <a href="https://r4ds.had.co.nz/tibbles.html">explanation here</a>. Key packages in tidyverse include (borrowing from Kyle Walker’s <a href="https://walker-data.com/census-r/index.html"><strong>Analyzing US Census Data: Methods, Maps, and Models in R</strong></a><strong>)</strong>:</p>
<pre><code>    * readr (Wickham and Hester 2021), which contains tools for importing and exporting datasets;

    * dplyr (Wickham et al. 2021), a powerful framework for data wrangling tasks;

    * tidyr (Wickham 2021b), a package for reshaping data;

    * purrr (Henry and Wickham 2020), a comprehensive framework for functional programming and iteration;

    * ggplot2 (Wickham 2016), a data visualization package based on the Grammar of Graphics</code></pre>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="do">## install tidyverse with:</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("tidyverse")</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="do">## update tidyverse with:</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">#tidyverse_update()</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="do">## import tidyverse with:</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'dplyr' was built under R version 4.4.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.1     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.1
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="do">## see what packages are included with tidyverse:</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tidyverse_packages</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "broom"         "conflicted"    "cli"           "dbplyr"       
 [5] "dplyr"         "dtplyr"        "forcats"       "ggplot2"      
 [9] "googledrive"   "googlesheets4" "haven"         "hms"          
[13] "httr"          "jsonlite"      "lubridate"     "magrittr"     
[17] "modelr"        "pillar"        "purrr"         "ragg"         
[21] "readr"         "readxl"        "reprex"        "rlang"        
[25] "rstudioapi"    "rvest"         "stringr"       "tibble"       
[29] "tidyr"         "xml2"          "tidyverse"    </code></pre>
</div>
</div>
</section>
<section id="combine-functions-into-a-pipe" class="level2">
<h2 class="anchored" data-anchor-id="combine-functions-into-a-pipe">2. Combine functions into a pipe</h2>
<p>Using the symbol <code>|&gt;</code> we can chain multiple functions together.</p>
<div class="callout.note">
<p>Previously, <code>%&gt;%</code> was commonly used for pipes. Now, it is recommended to use <code>|&gt;</code> instead. In R Studio, you can use the keyboard shortcut <code>CTRL/CMD + SHIFT + M</code> to create a pipe. However, you can update R Studio’s default pipe using the instructions in <em>R for Data Science</em>, <a href="https://r4ds.hadley.nz/data-transform.html#sec-the-pipe">Ch. 3.4</a>.</p>
</div>
<p>Each new function in the pipeline operates on the results produced by the previous function.</p>
<p>Chaining functions together in a pipe like this:</p>
<pre><code>starwars |&gt;
  group_by(species) |&gt;
  summarise(avg_height = mean(height, na.rm = TRUE)) |&gt;
  arrange(avg_height)</code></pre>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">|&gt;</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(species) <span class="sc">|&gt;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_height =</span> <span class="fu">mean</span>(height, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(avg_height)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 38 × 2
   species        avg_height
   &lt;chr&gt;               &lt;dbl&gt;
 1 Yoda's species        66 
 2 Aleena                79 
 3 Ewok                  88 
 4 Vulptereen            94 
 5 Dug                  112 
 6 Xexto                122 
 7 Droid                131.
 8 Toydarian            137 
 9 Sullustan            160 
10 Toong                163 
# ℹ 28 more rows</code></pre>
</div>
</div>
<p>produces the same results as nesting a series of functions within another:</p>
<pre><code>arrange(
  summarise(
    group_by(starwars, species), 
    avg_height = mean(height, na.rm = TRUE)
  ), 
  avg_height
)</code></pre>
<p>or calling each function in order:</p>
<pre><code>x1 &lt;- starwars 
x2 &lt;- group_by(x1, species)
x3 &lt;- summarise(x3, avg_height = mean(height, na.rm = TRUE))
arrange(x3, avg_height)</code></pre>
<p>By default <code>|&gt;</code> passes the result of the left hand side to the the first unnamed argument of the function on the right hand side. To override this default, use <code>_</code> as a placeholder within the function call on the right hand side. <code>|&gt;</code> will evaluate <code>_</code> as the result of the left hand side, instead of passing the result to the first unnamed argument.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">|&gt;</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(mass <span class="sc">~</span> height, <span class="at">data =</span> _)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = mass ~ height, data = starwars)

Coefficients:
(Intercept)       height  
    -11.487        0.624  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the old piping syntax</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co">#starwars %&gt;%</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co">#  lm(mass ~ height, data = .)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code></code></pre>
</section>
<section id="tidy-data-tibbles" class="level2">
<h2 class="anchored" data-anchor-id="tidy-data-tibbles">3. Tidy Data &amp; Tibbles</h2>
<p>From the <a href="https://rstudio-education.github.io/tidyverse-cookbook/tidy.html">Tidyverse cookbook</a>:</p>
<p>Data tidying refers to reshaping your data into a tidy data frame or <a href="https://rstudio-education.github.io/tidyverse-cookbook/how-to-use-this-book.html#tidy-data">tibble</a>. Data tidying is an important first step for your analysis because every tidyverse function will expect your data to be stored as <strong>Tidy Data</strong>.</p>
<p>Tidy data is tabular data organized so that:</p>
<ol type="1">
<li><p>Each column contains a single variable</p></li>
<li><p>Each row contains a single observation</p></li>
</ol>
<p>Tidy data is not an arbitrary requirement of the tidyverse; it is the ideal data format for doing data science with R. Tidy data makes it easy to extract every value of a variable to build a plot or to compute a summary statistic. Tidy data also makes it easy to compute new variables; when your data is tidy, you can rely on R’s rowwise operations to maintain the integrity of your observations. Moreover, R can directly manipulate tidy data with R’s fast, built-in vectorised observations, which lets your code run as fast as possible.</p>
<p>The definition of Tidy Data isn’t complete until you define variable and observation, so let’s borrow two definitions from <a href="https://r4ds.had.co.nz/exploratory-data-analysis.html"><em>R for Data Science</em></a>:</p>
<ol type="1">
<li><p>A <strong>variable</strong> is a quantity, quality, or property that you can measure.</p></li>
<li><p>An <strong>observation</strong> is a set of measurements made under similar conditions (you usually make all of the measurements in an observation at the same time and on the same object).</p></li>
</ol>
<p>As you work with data, you will be surprised to realize that what is a variable (or observation) will depend less on the data itself and more on what you are trying to do with it. With enough mental flexibility, you can consider anything to be a variable. However, some variables will be more useful than others for any specific task. In general, if you can formulate your task as an equation (math or code that contains an equals sign), the most useful variables will be the names in the equation.</p>
<section id="a.-create-a-tibble-from-scratch" class="level3">
<h3 class="anchored" data-anchor-id="a.-create-a-tibble-from-scratch">3a. Create a tibble from scratch</h3>
<p>Rarely will you ever create a dataframe or tibble from scratch except to create small practice datasets.</p>
<p>Here, we create a small practice dataset about the popular murder mystery TV show, <a href="https://www.imdb.com/title/tt11691774/"><em>Only Murders in the Building</em></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>omitb <span class="ot">&lt;-</span> <span class="fu">tribble</span>(<span class="sc">~</span>name, <span class="sc">~</span>occupation, <span class="sc">~</span>apartment, <span class="sc">~</span>is_suspect, <span class="sc">~</span>is_dead,</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Charles"</span>, <span class="st">"washed-up actor"</span>, <span class="st">"14C"</span>, <span class="st">"no"</span>, <span class="st">"no"</span>,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Mabel"</span>, <span class="st">"unemployed never-was"</span>, <span class="st">"12E"</span>, <span class="st">"maybe"</span>, <span class="st">"no"</span>,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Oliver"</span>, <span class="st">"theater director"</span>, <span class="st">"10D"</span>, <span class="st">"no"</span>, <span class="st">"no"</span>,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Howard"</span>, <span class="st">"childless cat guy"</span>, <span class="st">"3D"</span>, <span class="st">"yes"</span>, <span class="st">"no"</span>,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Bunny"</span>, <span class="st">"petty despot"</span>, <span class="st">"12A"</span>, <span class="st">"no"</span>, <span class="st">"maybe"</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>omitb</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 5
  name    occupation           apartment is_suspect is_dead
  &lt;chr&gt;   &lt;chr&gt;                &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;  
1 Charles washed-up actor      14C       no         no     
2 Mabel   unemployed never-was 12E       maybe      no     
3 Oliver  theater director     10D       no         no     
4 Howard  childless cat guy    3D        yes        no     
5 Bunny   petty despot         12A       no         maybe  </code></pre>
</div>
</div>
<p>We can add a new row by piping the function <strong>add_row.</strong> To figure out how do so, we can review the <a href="https://tibble.tidyverse.org/reference/add_row.html">function’s documentation</a>. Note: the default is to add the new row to the bottom of the tibble. To add it before the first row we need to set the argument <code>.before = 1</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>omitb <span class="ot">&lt;-</span> omitb <span class="sc">|&gt;</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_row</span>(<span class="at">name=</span><span class="st">"Jan"</span>, <span class="at">occupation =</span> <span class="st">"2nd-chair basoonist"</span>, </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">is_suspect=</span><span class="st">"yes"</span>, <span class="at">is_dead=</span><span class="st">"no"</span>, <span class="at">.before=</span><span class="dv">1</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>omitb</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  name    occupation           apartment is_suspect is_dead
  &lt;chr&gt;   &lt;chr&gt;                &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;  
1 Jan     2nd-chair basoonist  &lt;NA&gt;      yes        no     
2 Charles washed-up actor      14C       no         no     
3 Mabel   unemployed never-was 12E       maybe      no     
4 Oliver  theater director     10D       no         no     
5 Howard  childless cat guy    3D        yes        no     
6 Bunny   petty despot         12A       no         maybe  </code></pre>
</div>
</div>
<p>Above we used the <strong>tribble</strong> function to create a <strong>tibble</strong> (tribble vs.&nbsp;tibble - confusing right?) by using a syntax that lines up the rows neatly in a way that will preview the result.</p>
<p>You can also create the same tibble using the <strong>tibble</strong> function and passing in a list with the values of column:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">"Charles"</span>, <span class="st">"Mabel"</span>, <span class="st">"Oliver"</span>, <span class="st">"Howard"</span>, <span class="st">"Bunny"</span>),</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">occupation =</span> <span class="fu">c</span>(<span class="st">"washed-up actor"</span>, <span class="st">"unemployed never-was"</span>, <span class="st">"theater director"</span>, <span class="st">"childless cat guy"</span>, <span class="st">"petty despot"</span>),</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">apartment =</span> <span class="fu">c</span>(<span class="st">"14C"</span>, <span class="st">"12E"</span>, <span class="st">"10D"</span>, <span class="st">"3D"</span>, <span class="st">"12A"</span>),</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">is_suspect =</span> <span class="fu">c</span>(<span class="st">"no"</span>, <span class="st">"no"</span>, <span class="st">"no"</span>, <span class="st">"yes"</span>, <span class="st">"no"</span>),</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">is_dead =</span> <span class="fu">c</span>(<span class="st">"no"</span>, <span class="st">"no"</span>, <span class="st">"no"</span>, <span class="st">"no"</span>, <span class="st">"maybe"</span>),</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>       )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 5
  name    occupation           apartment is_suspect is_dead
  &lt;chr&gt;   &lt;chr&gt;                &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;  
1 Charles washed-up actor      14C       no         no     
2 Mabel   unemployed never-was 12E       no         no     
3 Oliver  theater director     10D       no         no     
4 Howard  childless cat guy    3D        yes        no     
5 Bunny   petty despot         12A       no         maybe  </code></pre>
</div>
</div>
</section>
<section id="b.-preloaded-datasets" class="level3">
<h3 class="anchored" data-anchor-id="b.-preloaded-datasets">3b. preloaded datasets</h3>
<p>We have already used the preloaded <code>starwars</code> dataset. But is it a tibble, a dataframe, or something else?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(starwars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "tbl_df"     "tbl"        "data.frame"</code></pre>
</div>
</div>
</section>
<section id="c.-dataframes-vs.-tibbles" class="level3">
<h3 class="anchored" data-anchor-id="c.-dataframes-vs.-tibbles">3c. Dataframes vs.&nbsp;tibbles</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../data/census1970.csv"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="convert-a-dataframe-into-a-tibble" class="level4">
<h4 class="anchored" data-anchor-id="convert-a-dataframe-into-a-tibble">Convert a dataframe into a tibble</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  rownum STATE COUNTY              NAME TOTPOP   WPOP NEGTOT OTHRACES   MTOT
1      1     1     10 FAIRFIELD         792814 732304  56408     4102 381603
2      2     1     30 HARTFORD          816737 758086  54645     4006 394728
3      3     1     50 LITCHFIELD        144091 142649   1126      316  70176
4      4     1     70 MIDDLESEX         114816 111102   3327      387  56465
5      5     1     90 NEW HAVEN         744948 684743  56630     3575 359204
6      6     1    110 NEW LONDON        230348 221073   7390     1885 115752
    M04   M56   M79 M1013  M14  M15 M1617 M1819  M20  M21 M2224 M2534 M3544
1 32152 15536 24082 33345 8129 8059 15054 11245 5006 4485 13869 44111 48524
2 34432 15927 24454 33771 8118 7984 15238 11862 5168 5129 17665 50392 47027
3  6172  2833  4302  5993 1491 1488  2784  1975  753  719  2631  8513  7935
4  4952  2305  3506  4709 1133 1116  2017  1883  825  840  2404  7483  6622
5 31329 14023 21708 29890 7122 7156 13528 12637 5528 5240 16988 44185 40199
6 10946  4976  7329  9386 2192 2186  3964  4027 2274 2470  7584 16524 12821
  M4554 M5559 M6061 M6264 M6574   M75   FTOT   F04   F56   F79 F1013  F14  F15
1 51181 21292  7003  9010 18823 10697 411211 30932 15026 23313 32321 7773 7446
2 50696 20465  6991  8801 19346 11262 422009 33550 15350 23335 32498 8082 7688
3  8618  3960  1398  1819  4289  2503  73915  5896  2778  4196  5636 1423 1403
4  6733  2825  1036  1304  3033  1739  58351  4845  2209  3362  4553 1029 1083
5 45636 18725  6420  8196 19212 11482 385744 30522 13707 20665 28656 7213 6771
6 12164  4783  1828  2179  5119  3000 114596 10492  4623  7098  8922 2142 2010
  F1617 F1819  F20  F21 F2224 F2534 F3544 F4554 F5559 F6061 F6264 F6574   F75
1 14651 11814 5736 5411 16418 49023 51666 54853 22422  7681 10120 26181 18424
2 14579 13353 6771 6786 20770 51528 49512 53062 21459  7759 10232 27049 18646
3  2602  1908  884  873  3038  8688  8098  9366  4243  1536  2080  5358  3909
4  1953  1508  785  799  2741  7527  6593  7239  2887  1104  1408  3829  2897
5 13060 11985 6097 6060 18958 46105 43485 49626 20698  7375  9759 26603 18399
6  3880  3890 2047 2043  5826 14816 12645 12821  5094  1939  2479  6794  5035
  NEGMTOT NEGM04 NEGM514 NEGM1524 NEGM2534 NEGM3544 NEGM4554 NEGM5564 NEGM65
1   26161   3344    6917     4332     3977     2943     2262     1427    959
2   26069   3507    7105     4427     3790     2845     2281     1248    866
3     592     59     137       97       69       76       57       52     45
4    1630    203     367      358      271      169      123       71     68
5   26538   3665    7537     4888     3434     2745     2140     1188    941
6    3644    416     979      734      465      462      310      160    118
  NEGFTOT NEGF04 NEGF514 NEGF1524 NEGF2534 NEGF3544 NEGF4554 NEGF5564 NEGF65
1   30247   3513    7143     5187     4901     3450     2783     1848   1422
2   28576   3442    6717     5582     4574     3227     2385     1380   1269
3     534     62      98       87       62       71       43       68     43
4    1697    202     433      369      262      167      117       72     75
5   30092   3917    7436     5544     4565     3386     2498     1460   1286
6    3746    431     939      744      510      454      348      158    162
  TOTPOP2  HHPOP HHHEADS HHPRIM HHMHEAD HHFHEAD HHFSPOUS HHOTHREL HHUNREL GROUP
1  792814 778212  243806  41569  181747   20490   176172   346686   11548 14602
2  816737 799712  255437  48242  184924   22271   179067   352227   12981 17025
3  144091 142582   45550   8085   34330    3135    33245    62151    1636  1509
4  114816 109867   34758   5830   26409    2519    25706    48076    1327  4949
5  744948 725581  231754  42156  168111   21487   162404   321253   10170 19367
6  230348 214257   67618  11833   49180    6605    47778    96592    2269 16091
  INMATES GROUPOTH NEGTOT2 HHNEG HHNEGHEA HHNEGPRI HHNEGMHE HHNEGFHE HHNEGFSP
1    6556     8046   56408 55207    15685     3162     8879     3644     8260
2    8116     8909   54645 53442    15533     3408     8322     3803     7659
3     878      631    1126  1075      306       62      214       30      193
4    3079     1870    3327  2952      819      178      480      161      453
5    8467    10900   56630 55416    15613     3096     8481     4036     7948
6    3736    12355    7390  6793     1857      329     1128      400     1042
  HHNEGOTR HHNEGUNR GROUPNEG INMATNEG GROUNEGO REGION1 REGION2 STATEFIP FIPS
1    29100     2162     1201      582      619       1       1        9 9001
2    28526     1724     1203      656      547       1       1        9 9003
3      512       64       51       29       22       1       1        9 9005
4     1592       88      375      276       99       1       1        9 9007
5    30421     1434     1214      742      472       1       1        9 9009
6     3794      100      597      298      299       1       1        9 9011
  LEVEL
1     1
2     1
3     1
4     1
5     1
6     1</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>df2tib <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="tidyverse-dplyr-verbs-for-data-wrangling" class="level2">
<h2 class="anchored" data-anchor-id="tidyverse-dplyr-verbs-for-data-wrangling">4. Tidyverse / dplyr verbs for Data Wrangling</h2>
<p>To modify and “wrangle” datasets, the tidyverse commonly uses the following verbs / functions:</p>
<ul>
<li><p><strong>select()</strong>: to select specific columns by their names or data types</p></li>
<li><p><strong>arrange()</strong>: to order rows by one or more columns</p></li>
<li><p><strong>rename()</strong>: to rename columns</p></li>
<li><p><strong>mutate()</strong>: to create columns</p></li>
<li><p><strong>filter()</strong>: to filter out rows by a given condition</p></li>
<li><p><strong>distinct()</strong>: to keep only distinct / unique rows</p></li>
<li><p><strong>gather()</strong>: to make “wide” data longer</p></li>
<li><p><strong>spread()</strong>: to make “long” data wider</p></li>
<li><p><strong>separate()</strong>: to split a single column into multiple columns</p></li>
<li><p><strong>unite()</strong>: to combine multiple columns into one</p></li>
</ul>
<p><a href="https://dplyr.tidyverse.org/reference/index.html">More tidyverse verbs and functions here</a>.</p>
<section id="a.-common-data-science-operations-in-tidyverse" class="level3">
<h3 class="anchored" data-anchor-id="a.-common-data-science-operations-in-tidyverse">4a. Common Data Science Operations in Tidyverse</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 29%">
<col style="width: 20%">
<col style="width: 23%">
</colgroup>
<thead>
<tr class="header">
<th>Task</th>
<th>Python - Pandas</th>
<th>Base R</th>
<th>Tidyverse (R)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Sort table by column</strong></td>
<td>df.sort_values(‘col’)</td>
<td>sort(df$col)</td>
<td><pre><code>df %&gt;%
    arrange(col)</code></pre></td>
</tr>
<tr class="even">
<td><strong>Filter rows</strong></td>
<td>df.loc[df[‘col’]&gt;0,:]</td>
<td>df[df[col] &gt; 0, ]</td>
<td><p>df %&gt;%</p>
<p>filter(col &gt; 0)</p></td>
</tr>
<tr class="odd">
<td><strong>Subset columns</strong></td>
<td><p>df[[col]] or</p>
<p>df.loc[:, col]</p></td>
<td>df$col</td>
<td><p>df %&gt;%</p>
<p>select(col)</p></td>
</tr>
<tr class="even">
<td><strong>Create a new column</strong></td>
<td>df.loc[:, “square”] = df[col] ** 2</td>
<td>df$square = df[col] ^2</td>
<td><p>df %&gt;%</p>
<p>mutate(square = col ^ 2)</p></td>
</tr>
<tr class="odd">
<td><strong>Perform calculation on column</strong></td>
<td>sum(df[“col”])</td>
<td>sum(df$col)</td>
<td><p>df %&gt;%</p>
<p>summarise(sumcol = sum(col))</p></td>
</tr>
<tr class="even">
<td><strong>Delete duplicate rows</strong></td>
<td>df.drop_duplicates()</td>
<td>df[!duplicated(df), ]</td>
<td><p>df %&gt;%</p>
<p>distinct()</p></td>
</tr>
<tr class="odd">
<td><strong>Group/Apply/Combine</strong></td>
<td>df.groupby(“col”).sum()</td>
<td><p>by(df, col, sum(x))</p>
<p>???</p></td>
<td><p>df %&gt;%</p>
<p>group_by(col) %&gt;%</p>
<p>summarise(groupsum = sum(col2))</p></td>
</tr>
<tr class="even">
<td><strong>Reshape data from wide to long</strong></td>
<td><em>pd.wide_to_long()</em></td>
<td><em>melt()</em></td>
<td><em>use pivot_longer()</em></td>
</tr>
</tbody>
</table>
</section>
<section id="b.-arrange-sorting" class="level3">
<h3 class="anchored" data-anchor-id="b.-arrange-sorting">4b. ARRANGE: Sorting</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">|&gt;</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(homeworld)  <span class="co">#descending order: arrange(desc(homeworld))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 87 × 14
   name     height  mass hair_color skin_color eye_color birth_year sex   gender
   &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
 1 Leia Or…    150    49 brown      light      brown             19 fema… femin…
 2 Bail Pr…    191    NA black      tan        brown             67 male  mascu…
 3 Raymus …    188    79 brown      light      brown             NA male  mascu…
 4 Ratts T…     79    15 none       grey, blue unknown           NA male  mascu…
 5 Lobot       175    79 none       light      blue              37 male  mascu…
 6 Jek Ton…    180   110 brown      fair       blue              NA &lt;NA&gt;  &lt;NA&gt;  
 7 Nute Gu…    191    90 none       mottled g… red               NA male  mascu…
 8 Ki-Adi-…    198    82 white      pale       yellow            92 male  mascu…
 9 Mas Ame…    196    NA none       blue       blue              NA male  mascu…
10 Mon Mot…    150    NA auburn     fair       blue              48 fema… femin…
# ℹ 77 more rows
# ℹ 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
#   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
</div>
</div>
</section>
<section id="c.-filter-rows" class="level3">
<h3 class="anchored" data-anchor-id="c.-filter-rows">4c. FILTER (rows)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">|&gt;</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(species<span class="sc">==</span><span class="st">"Droid"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 14
  name   height  mass hair_color skin_color  eye_color birth_year sex   gender  
  &lt;chr&gt;   &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;   
1 C-3PO     167    75 &lt;NA&gt;       gold        yellow           112 none  masculi…
2 R2-D2      96    32 &lt;NA&gt;       white, blue red               33 none  masculi…
3 R5-D4      97    32 &lt;NA&gt;       white, red  red               NA none  masculi…
4 IG-88     200   140 none       metal       red               15 none  masculi…
5 R4-P17     96    NA none       silver, red red, blue         NA none  feminine
6 BB8        NA    NA none       none        black             NA none  masculi…
# ℹ 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
#   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
</div>
</div>
</section>
<section id="d.-select-subset-columns" class="level3">
<h3 class="anchored" data-anchor-id="d.-select-subset-columns">4d. SELECT: Subset (columns)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">|&gt;</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, homeworld, species)  <span class="co">#reorder names here to reorder columns</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 87 × 3
   name               homeworld species
   &lt;chr&gt;              &lt;chr&gt;     &lt;chr&gt;  
 1 Luke Skywalker     Tatooine  Human  
 2 C-3PO              Tatooine  Droid  
 3 R2-D2              Naboo     Droid  
 4 Darth Vader        Tatooine  Human  
 5 Leia Organa        Alderaan  Human  
 6 Owen Lars          Tatooine  Human  
 7 Beru Whitesun Lars Tatooine  Human  
 8 R5-D4              Tatooine  Droid  
 9 Biggs Darklighter  Tatooine  Human  
10 Obi-Wan Kenobi     Stewjon   Human  
# ℹ 77 more rows</code></pre>
</div>
</div>
<section id="for-a-range-of-columns" class="level4">
<h4 class="anchored" data-anchor-id="for-a-range-of-columns">For a range of columns</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">|&gt;</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name<span class="sc">:</span>hair_color, species)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 87 × 5
   name               height  mass hair_color    species
   &lt;chr&gt;               &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;  
 1 Luke Skywalker        172    77 blond         Human  
 2 C-3PO                 167    75 &lt;NA&gt;          Droid  
 3 R2-D2                  96    32 &lt;NA&gt;          Droid  
 4 Darth Vader           202   136 none          Human  
 5 Leia Organa           150    49 brown         Human  
 6 Owen Lars             178   120 brown, grey   Human  
 7 Beru Whitesun Lars    165    75 brown         Human  
 8 R5-D4                  97    32 &lt;NA&gt;          Droid  
 9 Biggs Darklighter     183    84 black         Human  
10 Obi-Wan Kenobi        182    77 auburn, white Human  
# ℹ 77 more rows</code></pre>
</div>
</div>
</section>
</section>
<section id="e.-rename-columns" class="level3">
<h3 class="anchored" data-anchor-id="e.-rename-columns">4e. RENAME columns</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">|&gt;</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">character =</span> name, <span class="at">planet =</span> homeworld)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 87 × 14
   character       height  mass hair_color skin_color eye_color birth_year sex  
   &lt;chr&gt;            &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;
 1 Luke Skywalker     172    77 blond      fair       blue            19   male 
 2 C-3PO              167    75 &lt;NA&gt;       gold       yellow         112   none 
 3 R2-D2               96    32 &lt;NA&gt;       white, bl… red             33   none 
 4 Darth Vader        202   136 none       white      yellow          41.9 male 
 5 Leia Organa        150    49 brown      light      brown           19   fema…
 6 Owen Lars          178   120 brown, gr… light      blue            52   male 
 7 Beru Whitesun …    165    75 brown      light      blue            47   fema…
 8 R5-D4               97    32 &lt;NA&gt;       white, red red             NA   none 
 9 Biggs Darkligh…    183    84 black      light      brown           24   male 
10 Obi-Wan Kenobi     182    77 auburn, w… fair       blue-gray       57   male 
# ℹ 77 more rows
# ℹ 6 more variables: gender &lt;chr&gt;, planet &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
#   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
</div>
</div>
</section>
<section id="f.-mutate-create-new-columns" class="level3">
<h3 class="anchored" data-anchor-id="f.-mutate-create-new-columns">4f. MUTATE: create new columns</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(starwars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 14
  name      height  mass hair_color skin_color eye_color birth_year sex   gender
  &lt;chr&gt;      &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
1 Luke Sky…    172    77 blond      fair       blue            19   male  mascu…
2 C-3PO        167    75 &lt;NA&gt;       gold       yellow         112   none  mascu…
3 R2-D2         96    32 &lt;NA&gt;       white, bl… red             33   none  mascu…
4 Darth Va…    202   136 none       white      yellow          41.9 male  mascu…
5 Leia Org…    150    49 brown      light      brown           19   fema… femin…
6 Owen Lars    178   120 brown, gr… light      blue            52   male  mascu…
# ℹ 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
#   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">|&gt;</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">taller_than122cm =</span> <span class="fu">ifelse</span>(height <span class="sc">&gt;</span> <span class="dv">122</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 87 × 15
   name     height  mass hair_color skin_color eye_color birth_year sex   gender
   &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
 1 Luke Sk…    172    77 blond      fair       blue            19   male  mascu…
 2 C-3PO       167    75 &lt;NA&gt;       gold       yellow         112   none  mascu…
 3 R2-D2        96    32 &lt;NA&gt;       white, bl… red             33   none  mascu…
 4 Darth V…    202   136 none       white      yellow          41.9 male  mascu…
 5 Leia Or…    150    49 brown      light      brown           19   fema… femin…
 6 Owen La…    178   120 brown, gr… light      blue            52   male  mascu…
 7 Beru Wh…    165    75 brown      light      blue            47   fema… femin…
 8 R5-D4        97    32 &lt;NA&gt;       white, red red             NA   none  mascu…
 9 Biggs D…    183    84 black      light      brown           24   male  mascu…
10 Obi-Wan…    182    77 auburn, w… fair       blue-gray       57   male  mascu…
# ℹ 77 more rows
# ℹ 6 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
#   vehicles &lt;list&gt;, starships &lt;list&gt;, taller_than122cm &lt;lgl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="st">"A New Hope"</span> <span class="sc">%in%</span> starwars<span class="sc">$</span>films[[<span class="dv">1</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>starwars<span class="sc">$</span>films[<span class="dv">12</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] "A New Hope"          "Revenge of the Sith"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">|&gt;</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">in_new_hope =</span> <span class="fu">map_lgl</span>(films, <span class="sc">~</span><span class="st">"A New Hope"</span> <span class="sc">%in%</span> .x)) <span class="sc">|&gt;</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(in_new_hope <span class="sc">==</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 18 × 15
   name     height  mass hair_color skin_color eye_color birth_year sex   gender
   &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
 1 Luke Sk…    172    77 blond      fair       blue            19   male  mascu…
 2 C-3PO       167    75 &lt;NA&gt;       gold       yellow         112   none  mascu…
 3 R2-D2        96    32 &lt;NA&gt;       white, bl… red             33   none  mascu…
 4 Darth V…    202   136 none       white      yellow          41.9 male  mascu…
 5 Leia Or…    150    49 brown      light      brown           19   fema… femin…
 6 Owen La…    178   120 brown, gr… light      blue            52   male  mascu…
 7 Beru Wh…    165    75 brown      light      blue            47   fema… femin…
 8 R5-D4        97    32 &lt;NA&gt;       white, red red             NA   none  mascu…
 9 Biggs D…    183    84 black      light      brown           24   male  mascu…
10 Obi-Wan…    182    77 auburn, w… fair       blue-gray       57   male  mascu…
11 Wilhuff…    180    NA auburn, g… fair       blue            64   male  mascu…
12 Chewbac…    228   112 brown      unknown    blue           200   male  mascu…
13 Han Solo    180    80 brown      fair       brown           29   male  mascu…
14 Greedo      173    74 &lt;NA&gt;       green      black           44   male  mascu…
15 Jabba D…    175  1358 &lt;NA&gt;       green-tan… orange         600   herm… mascu…
16 Wedge A…    170    77 brown      fair       hazel           21   male  mascu…
17 Jek Ton…    180   110 brown      fair       blue            NA   &lt;NA&gt;  &lt;NA&gt;  
18 Raymus …    188    79 brown      light      brown           NA   male  mascu…
# ℹ 6 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
#   vehicles &lt;list&gt;, starships &lt;list&gt;, in_new_hope &lt;lgl&gt;</code></pre>
</div>
</div>
</section>
<section id="exercise" class="level3 tip">
<h3 class="anchored" data-anchor-id="exercise">Exercise</h3>
<p>Using what you learned above:</p>
<ol type="1">
<li>Subset the Star Wars dataset, keeping only characters’ name, homeworld, and species.</li>
<li>Sort the dataset by species.</li>
<li>Then, create a new column that identifies whether the character is an organic lifeform or not.</li>
</ol>
</section>
</section>
<section id="split-apply-combine" class="level2">
<h2 class="anchored" data-anchor-id="split-apply-combine">5. Split-Apply-Combine</h2>
<p>A very common data science technique is to split a dataset into groups, perform some action on each of those groups, and then combine the results from each group into one new dataset. For example, we can use this technique to calculate the average height of Star Wars characters by species using the <strong>group_by()</strong> and <strong>summarise()</strong> functions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">|&gt;</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(species)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 87 × 14
# Groups:   species [38]
   name     height  mass hair_color skin_color eye_color birth_year sex   gender
   &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
 1 Luke Sk…    172    77 blond      fair       blue            19   male  mascu…
 2 C-3PO       167    75 &lt;NA&gt;       gold       yellow         112   none  mascu…
 3 R2-D2        96    32 &lt;NA&gt;       white, bl… red             33   none  mascu…
 4 Darth V…    202   136 none       white      yellow          41.9 male  mascu…
 5 Leia Or…    150    49 brown      light      brown           19   fema… femin…
 6 Owen La…    178   120 brown, gr… light      blue            52   male  mascu…
 7 Beru Wh…    165    75 brown      light      blue            47   fema… femin…
 8 R5-D4        97    32 &lt;NA&gt;       white, red red             NA   none  mascu…
 9 Biggs D…    183    84 black      light      brown           24   male  mascu…
10 Obi-Wan…    182    77 auburn, w… fair       blue-gray       57   male  mascu…
# ℹ 77 more rows
# ℹ 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
#   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">|&gt;</span> </span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(species) <span class="sc">|&gt;</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_height =</span> <span class="fu">mean</span>(height, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 38 × 2
   species   avg_height
   &lt;chr&gt;          &lt;dbl&gt;
 1 Aleena           79 
 2 Besalisk        198 
 3 Cerean          198 
 4 Chagrian        196 
 5 Clawdite        168 
 6 Droid           131.
 7 Dug             112 
 8 Ewok             88 
 9 Geonosian       183 
10 Gungan          209.
# ℹ 28 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">|&gt;</span>    </span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(species) <span class="sc">|&gt;</span>   </span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_height =</span> <span class="fu">mean</span>(height, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span>  </span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(avg_height) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 38 × 2
   species        avg_height
   &lt;chr&gt;               &lt;dbl&gt;
 1 Yoda's species        66 
 2 Aleena                79 
 3 Ewok                  88 
 4 Vulptereen            94 
 5 Dug                  112 
 6 Xexto                122 
 7 Droid                131.
 8 Toydarian            137 
 9 Sullustan            160 
10 Toong                163 
# ℹ 28 more rows</code></pre>
</div>
</div>
<section id="exercise-1" class="level3 tip">
<h3 class="anchored" data-anchor-id="exercise-1">Exercise</h3>
<p>Using the split-apply-combine technique and other methods learned above, do at least one of the following:</p>
<ol type="1">
<li>Identify the most common species for each planet.</li>
<li>Identify the most common eye color for each species.</li>
<li>Identify the average and maximum age (so two columns) for each species.</li>
<li>answer a similar question of your own</li>
</ol>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>